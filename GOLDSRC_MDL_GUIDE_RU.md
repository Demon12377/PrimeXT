# База знаний по лимитам и созданию моделей .mdl для GoldSrc (и PrimeXT)

## 1. Введение
Компилятор `pxstudiomdl` является современным наследником классических инструментов и предназначен для создания моделей, совместимых с GoldSrc, Xash3D и PrimeXT. Он автоматически расширяет многие внутренние лимиты компиляции, сохраняя при этом совместимость выходного формата с оригинальным движком Half-Life.

## 2. Основные лимиты моделей (GoldSrc)
Оригинальный движок GoldSrc имеет жесткие ограничения. Хотя `pxstudiomdl` позволяет обходить некоторые из них на этапе сборки, для корректной работы в оригинальной игре следует придерживаться следующих значений:

*   **Кости (Bones):** Максимум **128**. Это жесткий предел движка для одной модели.
*   **Вершины (Vertices):** До **16384** на одну подмодель (submodel). В оригинальном GoldSrc (Sven Co-op, старые билды) лимит часто был равен 2048, но `pxstudiomdl` ориентируется на расширенные стандарты.
*   **Треугольники (Triangles):** До **65535** на меш (ограничение формата индексации).
*   **Текстуры (Skins):** До **256** уникальных текстур в одном `.mdl` файле.
*   **Группы тел (Bodygroups):** До **32**.
*   **Подмодели (Models):** До **256** на всю модель.
*   **Анимации (Sequences):** До **1024**.
*   **Кадры анимации (Frames):** До **16386** на одну последовательность.
*   **События (Events):** До **64** на одну последовательность.
*   **Контроллеры костей (Bone Controllers):** До **32**.
*   **Аттачменты (Attachments):** До **64**.

## 3. Работа с текстурами и их размерами
В формате GoldSrc текстуры обычно вшиваются прямо в `.mdl` файл и используют 8-битную палитру.

*   **Стандартные размеры:** Рекомендуется использовать размеры, кратные степени двойки (64, 128, 256, 512).
*   **Лимит площади:** По умолчанию `pxstudiomdl` ограничивает площадь текстуры до **307200** пикселей (что соответствует примерно 554x554). Если текстура больше, компилятор её уменьшит.
*   **Фейковый тайлинг (Fake Tiling):** Для GoldSrc поддерживается возможность "повторения" текстуры до 4 раз (команда `$cliptotextures`). Это позволяет обойти визуальные ограничения разрешения, "размножив" детальную текстуру по поверхности.
*   **Внешние текстуры (PrimeXT):** Поддерживаются форматы `.tga`, `.bmp`, `.png`, `.dds` с разрешением до **4096x4096**. Однако это расширение PrimeXT/Xash3D и не будет работать в чистом GoldSrc.

## 4. Ключевые QC команды и их особенности

*   **`$cliptotextures`**: Отключает принудительную обрезку текстур по границам UV. Позволяет использовать текстурные координаты за пределами диапазона [0,1], что реализует "фейковый тайлинг" в GoldSrc. В `pxstudiomdl` этот флаг часто избыточен, так как компилятор старается сохранить координаты по умолчанию.
*   **`$fixedcoords`**: Включает текстурные координаты с плавающей точкой. **Только для Xash3D/PrimeXT**. Позволяет избежать потери точности UV, но ломает совместимость с GoldSrc.
*   **`$freecoords`**: Аналогично `$fixedcoords`, но также разрешает тайлинг. Также **только для Xash3D**.
*   **`$keepfreebones`**: Предотвращает удаление костей, к которым не привязана геометрия. Полезно для создания скелетов под общие анимации.
*   **`$collapsebones`**: Автоматически удаляет лишние кости без весов, помогая вписаться в лимит 128.
*   **`$texrendermode <название_текстуры> <режим>`**: Позволяет задать режим отрисовки (например, `masked` для прозрачности по индексу 255 или `additive`).
*   **`$jigglebone`**: Позволяет создавать "дрожащие" кости (физика во время игры). Работает в PrimeXT и современных портах Xash3D.

## 5. Профессиональные советы

1.  **Использование 512 флага:** Флаг `$flags 512` заставляет движок использовать хитбоксы для просчета коллизий вместо одного общего Bounding Box. Это критично для больших моделей.
2.  **Отладка хитбоксов:** Запуск компилятора с ключом `-h` (`pxstudiomdl.exe -h file.qc`) выведет в консоль точные координаты всех сгенерированных хитбоксов. Это удобно для их последующей ручной правки в QC.
3.  **Палитра прозрачности:** Для режима `masked` (текстуры, начинающиеся с `{`) прозрачным считается последний цвет в палитре (индекс 255). Обычно это чистый синий цвет `RGB(0, 0, 255)`.
4.  **Гамма-коррекция:** Если текстуры в игре выглядят слишком темными или светлыми, используйте команду `$gamma` (стандарт — 1.8).

---
*Документация подготовлена Jules на основе анализа исходного кода PrimeXT (февраль 2025).*
