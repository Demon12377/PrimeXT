# Расширенная база знаний по лимитам и созданию моделей .mdl для GoldSrc (и PrimeXT)

## 1. Введение
Данный документ является справочником по формату `.mdl` на основе анализа исходного кода PrimeXT и компилятора `pxstudiomdl`. Он охватывает классические ограничения движка GoldSrc и современные возможности PrimeXT/Xash3D.

---

## 2. Технические лимиты (Hard Limits)

Для обеспечения совместимости с оригинальным GoldSrc (Half-Life, Sven Co-op), следует ориентироваться на следующие значения:

### Геометрия и Скелет
*   **Кости (Bones):** Максимум **128**. Это абсолютный предел движка. Если в вашей модели больше костей, используйте `$collapsebones` для удаления неиспользуемых.
*   **Вершины (Vertices):** До **16384** на одну подмодель (submodel). В оригинальном Half-Life лимит был 2048, но современные компиляторы и движки поддерживают 16k.
*   **Треугольники (Triangles):** До **65535** на меш.
*   **Аттачменты (Attachments):** До **64**.
*   **Контроллеры костей (Bone Controllers):** До **32**.
*   **Меши (Meshes):** До **256** на модель.
*   **Группы тел (Bodygroups):** До **32**.

---

## 3. Решение для текстур высокого разрешения (4096x4096px) на GoldSrc

Так как GoldSrc не поддерживает текстуры размером 4096px (лимит большинства движков 512px или 1024px), единственным способом является **метод нарезки меша (Mesh Slicing)**:

1.  **Разделение текстуры:** Исходная текстура 4096x4096px разрезается на сетку 8x8. Получается **64** текстуры размером **512x512px** каждая.
2.  **Разделение меша:** В 3D-редакторе меш модели также должен быть разделен на 64 части, каждая из которых использует свою уникальную текстуру из нарезанного набора.
3.  **Лимиты:** Общее количество текстур (64) полностью укладывается в лимит GoldSrc (256). Количество мешей (64) также укладывается в лимит (256).

---

## 4. Революционный Normal Mapping для FAMAS (GoldSrc vs PrimeXT)

### Способ А: Современный (PrimeXT / Xash3D)
В PrimeXT поддержка карт нормалей встроена. Вам не нужно менять код, достаточно правильно назвать файлы.
1.  **Подготовка:** Создайте основную текстуру (например, `famas.tga`) и карту нормалей (`famas_norm.tga`).
2.  **Размещение:** Положите их в папку `textures/v_famas/` (где `v_famas` — имя вашей модели).
3.  **Активация:** В консоли игры убедитесь, что `gl_bump 1`. Движок автоматически применит рельеф к модели.

### Способ Б: "Революционный" для чистого GoldSrc (Без Xash3D)
Поскольку оригинальный движок 1998 года не поддерживает Normal Mapping аппаратно, используются методы имитации:
1.  **Baking (Запекание):** Самый эффективный метод. В Blender запеките освещение и тени с High-Poly модели FAMAS прямо в Diffuse-текстуру (Ambient Occlusion + Cavity map). Это создаст визуальный объем, который "вшит" в картинку.
2.  **Detail Textures:** Используйте карту нормалей, переведенную в Grayscale, как "детальную текстуру". В некоторых версиях GoldSrc (например, Sven Co-op) это добавит микро-рельеф при приближении.
3.  **Fake Specular (Chrome):** Назначьте на металлические части FAMAS текстуру с флагом `Chrome`. Если сделать её очень темной и детальной, она будет имитировать блики от источников света, что часто путают с работой карт нормалей.

---

## 5. Справочник QC команд ($)

*   **`$noclampsize`**: **(Новая команда)** Отключает автоматическое уменьшение текстур до 512px. Позволяет использовать текстуры до **1024x1024** без активации `$fixedcoords`.
*   **`$cliptotextures`**: В `pxstudiomdl` этот флаг включен по умолчанию (используется вся текстура).
*   **`$fixedcoords`**: **(Только Xash/PrimeXT)** UV с плавающей точкой. Ломает отображение на стандартном GoldSrc.
*   **`$jigglebone`**: Физика дрожащих частей. Требует PrimeXT.
*   **`$boneweights`**: Веса костей (до 4 на вершину, только PrimeXT).

---

## 6. AI Промпт для генерации текстур (Nana Banano 2 Pro / SD / MJ)

Для генерации идеального набора текстур FAMAS используйте этот промпт:

> **Prompt:** *Ultra-realistic photorealistic 4K texture set for FAMAS F1 assault rifle, top-down view, seamless flat texture sheet. Includes Diffuse/Albedo, Normal Map, and Metallic/Roughness maps. Tactical matte polymer body, cold steel barrel with heat discoloration, minor industrial scratches, worn edges, oil stains. Scientific laboratory lighting, high contrast, non-overlapping UV layout style, professional game asset quality.*

---
*Документация актуализирована: Февраль 2025.*
