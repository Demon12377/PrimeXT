# Расширенная база знаний по лимитам и созданию моделей .mdl для GoldSrc (и PrimeXT)

## 1. Введение
Данный документ является максимально полным справочником по формату `.mdl` на основе анализа исходного кода PrimeXT и компилятора `pxstudiomdl`. Он охватывает как классические ограничения движка GoldSrc, так и современные возможности PrimeXT/Xash3D.

---

## 2. Технические лимиты (Hard Limits)

Для обеспечения совместимости с оригинальным GoldSrc (Half-Life 1.1.1.1+) и Sven Co-op, следует ориентироваться на следующие значения:

### Геометрия и Скелет
*   **Кости (Bones):** Максимум **128**. Это абсолютный предел движка. Если в вашей модели больше костей, используйте `$collapsebones` для удаления неиспользуемых.
*   **Вершины (Vertices):** До **16384** на одну подмодель (submodel). В оригинальном Half-Life лимит был 2048, но современные компиляторы и движки поддерживают 16k.
*   **Треугольники (Triangles):** До **65535** на меш.
*   **Аттачменты (Attachments):** До **64**.
*   **Контроллеры костей (Bone Controllers):** До **32**.
*   **Меши (Meshes):** До **256** на модель.
*   **Группы тел (Bodygroups):** До **32**.

### Анимация
*   **Последовательности (Sequences):** До **1024**.
*   **Кадры (Frames):** До **16386** на анимацию.
*   **События (Events):** До **64** на анимацию.
*   **Блендинг (Blends):** До **16** смешиваний в одной последовательности.

### Текстуры
*   **Количество текстур:** До **256**.
*   **Размер текстуры:** До **512x512** (рекомендуется для GoldSrc).
*   **Лимит площади:** `pxstudiomdl` по умолчанию сжимает текстуры больше **307200** пикселей (эквивалент ~554x554).

---

## 3. Решение для текстур высокого разрешения (4096x4096px) на GoldSrc

Пользовательский вопрос: *Как сделать так, чтобы итоговый результат на GoldSrc был идентичен текстуре 4096x4096px, без использования Xash3D?*

Так как GoldSrc не поддерживает текстуры размером 4096px (лимит 512px), единственным способом является **метод нарезки меша (Mesh Slicing)**:

1.  **Разделение текстуры:** Исходная текстура 4096x4096px разрезается на сетку 8x8. Получается **64** текстуры размером **512x512px** каждая.
2.  **Разделение меша:** В 3D-редакторе меш модели также должен быть разделен на 64 части (или больше, если геометрия сложная), каждая из которых использует свою уникальную текстуру из нарезанного набора.
3.  **Лимиты:** Общее количество текстур (64) полностью укладывается в лимит GoldSrc (256). Количество мешей (64) также укладывается в лимит (256).
4.  **Компиляция:** При компиляции через `pxstudiomdl` все 64 текстуры будут вшиты в `.mdl`. Визуально в игре они сойдутся в единое целое, создавая эффект 4096px разрешения.

**Важно:** Для избежания швов на стыках текстур убедитесь, что UV-координаты идеально выровнены по пикселям и не имеют "нахлестов".

---

## 4. Справочник QC команд ($)

Ниже приведен список команд, поддерживаемых `pxstudiomdl`, со ссылками на их функционал:

### Основные
*   **`$modelname <file.mdl>`**: Имя выходного файла.
*   **`$cd <path>`**: Рабочая директория с исходниками.
*   **`$body <name> <smd>`**: Добавление меша.
*   **`$bodygroup <name> { studio <smd> blank }`**: Группы сменных частей.

### Текстуры и UV
*   **`$cliptotextures`**: Реализует "фейковый тайлинг". Позволяет повторять текстуру до 4 раз в GoldSrc.
*   **`$fixedcoords`**: **(Только Xash/PrimeXT)** UV с плавающей точкой (высокая точность).
*   **`$freecoords`** (или `$freecords`): **(Только Xash/PrimeXT)** UV с плавающей точкой + поддержка тайлинга.
*   **`$texrendermode <tex> <mode>`**: Режимы отрисовки:
    *   `additive`: Аддитивное смешивание (свечение).
    *   `masked`: Прозрачность по индексу 255 (синий).
    *   `masked_solid`: Прозрачность с коллизией по видимой части.
    *   `fullbright`: Текстура не затеняется (всегда яркая).
    *   `alpha2coverage`: Сглаженная прозрачность (PrimeXT).
    *   `twoside`: Отрисовка обеих сторон полигона.
*   **`$externaltextures`**: Выносит текстуры в отдельный файл `_T.mdl` (для экономии памяти в старых версиях).

### Оптимизация и Кости
*   **`$staticprop`**: Оптимизирует модель как статический объект (без скелета).
*   **`$collapsebones`**: Удаляет кости без привязанных вершин.
*   **`$alwayscollapse <bone>`**: Принудительное удаление конкретной кости.
*   **`$keepfreebones`**: Сохраняет кости без геометрии (нужно для скриптовых костей или общих анимаций).
*   **`$definebone <name> <parent> <x> <y> <z> ...`**: Ручное описание параметров кости.
*   **`$insertbone <name> <parent>`**: Вставка новой кости в иерархию.
*   **`$renamebone <old> <new>`**: Переименование кости.

### Продвинутые функции
*   **`$jigglebone <bone> { ... }`**: Физика дрожащих частей (волосы, сумки, антенны). Требует поддержки движка (PrimeXT).
*   **`$lod <distance> { replacemodel <old> <new> }`**: Система уровней детализации.
*   **`$shadowlod`**: Выбор модели для отрисовки тени.
*   **`$boneweights`**: Включает поддержку весов костей (до 4 на вершину). Работает в PrimeXT.
*   **`$weightlist <name> { <bone> <weight> }`**: Группы весов для смешивания анимаций.
*   **`$poseparameter <name> <min> <max>`**: Параметры позы для плавного смешивания (как в Source Engine).

---

## 5. Режимы отрисовки (Render Modes)

| Режим | Описание |
|-------|----------|
| **Normal** | Стандартный непрозрачный режим. |
| **Masked** | Прозрачность по цвету с индексом 255. Полезно для решеток, листвы. Текстура должна начинаться с символа `{`. |
| **Additive** | Пиксели текстуры складываются с пикселями фона. Идеально для огня, лазеров. |
| **Chrome** | Эффект зеркального отражения (старый метод через `$texrendermode`). |

---

## 6. Советы профессионалов

1.  **Хитбоксы и Коллизия:** Всегда используйте `$flags 512`, если модель сложная. Это позволит игрокам стрелять "сквозь" пустые пространства модели.
2.  **Масштабирование:** Команды `$scale`, `$scale_x`, `$scale_y`, `$scale_z` позволяют быстро подогнать модель под размер игрового мира без переэкспорта из 3D-редактора.
3.  **Гамма:** Если текстуры в игре выглядят блеклыми, используйте `$gamma 2.2` (или другое значение), чтобы скорректировать цветовое пространство на этапе компиляции.
4.  **Отладка:** Используйте ключ командной строки `-dev 2` при запуске компилятора, чтобы увидеть подробный лог процесса и все ошибки парсинга QC.

---
*Документация актуализирована: Февраль 2025.*
