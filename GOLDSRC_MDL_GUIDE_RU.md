# Расширенная база знаний по лимитам и созданию моделей .mdl для GoldSrc (и PrimeXT)

## 1. Введение
Данный документ является справочником по формату `.mdl` на основе анализа исходного кода PrimeXT и компилятора `pxstudiomdl`. Он охватывает классические ограничения движка GoldSrc и современные возможности PrimeXT/Xash3D.

---

## 2. Технические лимиты (Hard Limits)

Для обеспечения совместимости с оригинальным GoldSrc (Half-Life, Sven Co-op), следует ориентироваться на следующие значения:

### Геометрия и Скелет
*   **Кости (Bones):** Максимум **128**. Это абсолютный предел движка. Если в вашей модели больше костей, используйте `$collapsebones` для удаления неиспользуемых.
*   **Вершины (Vertices):** До **16384** на одну подмодель (submodel). В оригинальном Half-Life лимит был 2048, но современные компиляторы и движки поддерживают 16k.
*   **Треугольники (Triangles):** До **65535** на меш.
*   **Аттачменты (Attachments):** До **64**.
*   **Контроллеры костей (Bone Controllers):** До **32**.
*   **Меши (Meshes):** До **256** на модель.
*   **Группы тел (Bodygroups):** До **32**.

### Анимация
*   **Последовательности (Sequences):** До **1024**.
*   **Кадры (Frames):** До **16386** на анимацию.
*   **События (Events):** До **64** на анимацию.

### Текстуры
*   **Количество текстур:** До **256**.
*   **Размер текстуры:** До **512x512** (стандарт GoldSrc).
*   **Лимит площади:** `pxstudiomdl` по умолчанию сжимает текстуры больше **307200** пикселей (эквивалент ~554x554).
*   **Максимальный физический размер:** 1024x1024 (ограничение квантизатора).

---

## 3. Решение для текстур высокого разрешения (4096x4096px) на GoldSrc

Пользовательский вопрос: *Как сделать так, чтобы итоговый результат на GoldSrc был идентичен текстуре 4096x4096px, без использования Xash3D?*

Так как GoldSrc не поддерживает текстуры размером 4096px (лимит большинства движков 512px или 1024px), единственным способом является **метод нарезки меша (Mesh Slicing)**:

1.  **Разделение текстуры:** Исходная текстура 4096x4096px разрезается на сетку 8x8. Получается **64** текстуры размером **512x512px** каждая.
2.  **Разделение меша:** В 3D-редакторе меш модели также должен быть разделен на 64 части, каждая из которых использует свою уникальную текстуру из нарезанного набора.
3.  **Лимиты:** Общее количество текстур (64) полностью укладывается в лимит GoldSrc (256). Количество мешей (64) также укладывается в лимит (256).
4.  **Компиляция:** При компиляции все 64 текстуры будут вшиты в `.mdl`. Визуально в игре они сойдутся в единое целое, создавая эффект 4096px разрешения.

---

## 4. Справочник QC команд ($)

### Текстуры и UV
*   **`$noclampsize`**: **(Новая команда)** Отключает автоматическое уменьшение текстур до 512px. Позволяет использовать текстуры до **1024x1024** без активации `$fixedcoords`. Идеально для GoldSrc-совместимых моделей высокого качества.
*   **`$cliptotextures`**: В `pxstudiomdl` этот флаг включен по умолчанию (используется вся текстура).
*   **`$fixedcoords`**: **(Только Xash/PrimeXT)** UV с плавающей точкой. Ломает отображение на стандартном GoldSrc.
*   **`$freecoords`**: **(Только Xash/PrimeXT)** UV с плавающей точкой + тайлинг.
*   **`$texrendermode <tex> <mode>`**: Режимы: `additive`, `masked` (индекс 255), `masked_solid`, `fullbright`, `alpha2coverage`, `twoside`.

### Оптимизация и Кости
*   **`$staticprop`**: Оптимизация для статики.
*   **`$collapsebones`**: Удаление лишних костей.
*   **`$keepfreebones`**: Сохранение пустых костей.
*   **`$renamebone <old> <new>`**: Переименование кости.
*   **`$bonemerge <bone>`**: Подготовка кости для слияния с другой моделью.

### Продвинутые
*   **`$jigglebone <bone> { ... }`**: Физика (волосы, антенны). Требует PrimeXT.
*   **`$lod <distance>`**, **`$shadowlod`**: Заглушки для систем детализации.
*   **`$boneweights`**: Веса костей (до 4 на вершину, только PrimeXT).
*   **`$poseparameter <name> <min> <max>`**: Параметры позы.

---

## 5. Советы профессионалов

1.  **Хитбоксы:** Всегда используйте `$flags 512` для сложных моделей.
2.  **Гамма:** Используйте `$gamma 1.8` или `2.2` для настройки яркости текстур.
3.  **Отладка:** Запуск с ключом `-dev 2` покажет подробный лог компиляции.

---
*Документация актуализирована: Февраль 2025.*
